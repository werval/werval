
=== Introduction

QiWeb is a HTTP development kit.
QiWeb is not a full stack framework.

In other words, QiWeb don't compell you to use any persistence mechanism nor templating engine.
You are free to choose whatever may suit your needs.

image::images/overview.png[Overview,640]


=== Application Structure

A QiWeb Application is nothing but a plain old Java program.
The framework provide a default `main` class/method for you to reuse but you can also write yours if you need it.
The minimal requirement is a configuration file named `application.conf` containing a `app.secret` entry.


=== Logging

The QiWeb Runtime use http://slf4j.org/[SLF4J] and http://logback.qos.ch/[Logback] logging and do not do anything
special regarding its configuration.
This means that you have full control of Logback configuration.
Therefore you are encouraged to read the official http://logback.qos.ch/documentation.html[Logback documentation].

All QiWeb loggers are present in the `org.qiweb` namespace according to code packages.
Here are the most useful:

- `org.qiweb.runtime.server` QiWeb Http Server
- `org.qiweb.runtime.routes` QiWeb Http Router
- `org.qiweb.runtime.controllers` QiWeb Controller
- `org.qiweb.runtime.filters` QiWeb Controller Filters
- etc...


=== Configuration

INFO: QiWeb configuration use the https://github.com/typesafehub/config/blob/master/HOCON.md[HOCON format] ("Human
Optimized Config Object Notation"). It is parsed using https://github.com/typesafehub/config[Typesafe Config].

The `application.conf` file must be present at the root of your classpath and must at least contain one single entry:
`app.secret` which is the secret key your application will use to sign session cookies.
For all other configuration properties, the QiWeb Runtime provide a `reference.conf` file that the Config library
automatically loads.
You can of course override all theses configuration properties in your `application.conf` file.

If you need to add configuration properties for your application you are encouraged to do so in your `application.conf`
file.

All configuration properties are available to your controllers and filters via the Context object.

[source,java]
----
import static org.qiweb.api.controllers.Controller.*;
public MyController {
  public Outcome aControllerMethod() {
    String configValue = application().config().getString("your.custom.config.key");
    // Do what you have to do according to the configuration value
    return outcomes().ok("whatever").build();
  }
}
----

All configuration properties can be overriden by defining System Properties.
This means that you can easily provide all configuration on the command line.

TIP: Every system property is also present in the configuration.
For example, the `java.home` System Property is automatically present in the configuration at the `java.home` key.
In other words, and if you need it, keep in mind that you can use configuration properties from the command line without
defining a default value in any configuration file.

Moreover, some special System Properties allow to use an alternate config file:

- `config.resource` to load configuration from the classpath
- `config.file` to load configuration from the filesystem
- `config.url` to load configuration from an URL

Note that this will replace the `application.conf` file, not add to it.
You still can leverage the inclusion mechanism of HOCON to include your `application.conf` file from the one you
specified using one of the System Properties described above.


=== Lifecycle

==== Startup explained

==== Shutdown explained

Shutting your application down gracefully is as critical as running it.

When shut down is requested (Ctrl-C, kill command etc...) the runtime is put in shutting down state for a maximum
amount of time defined by the `qiweb.shutdown.timeout` configuration property that default to 5 seconds.
Obviously, if there are no requests to process your application will shutdown immediatly.

While shutting down, your application will continue to serve running requests till they complete.
Clients using HTTP 1.1 Keep-Alive will see your application respond with a `Connection` header with `Close` value and
effectively close the connection.

Moreover, your application will respond to new incoming requests with a `503 Service Unavailable` status.
You can set the `qiweb.shutdown.retry-after` configuration property so that a `Retry-After` header is added to theses
responses.

If your application is running on multiple nodes behind a balancer you can lower this value to 0, yes *zero*, allowing
your clients to reconnect immediatly to another node. Pretty useful for zero-downtime upgrades.


==== The Global object

==== Instanciation

- Controllers
- Filters

==== Invocation

- Controllers
- Filters


=== Routes

Routes are defined by:

- a HTTP method ;
- a path expression ;
- a fully qualified method name ;
- optionaly a method parameters definition ;
- and finaly optional modifiers.

Teh default QiWeb router allows for textual representation of routes definition.

    http-method path-expression controller-fqcn.method-name[(parameters)] [modifiers]

You can also express routes definitions in code using the Routes API.

Request URI Path and QueryString are the source of Controller Parameters.



TIP: URI Fragment identifier is considered as useful only on the client side and hence is not taken into account when routing.
However, the reverse routing API allow you to append a fragment identifier to generated URIs.


=== Controllers


=== Outcomes


=== Filters


=== Session

As QiWeb is stateless oriented, it provides no way to keep session state server side.
Instead a simple session Cookie is used to keep state accross user requests.

The Session Cookie contains a `Map<String,String>` and is signed using the mandatory Application Secret.
Signature use the HmacSHA1 algorithm.


=== Cookies


=== Forms & Uploads


=== WebSockets

=== SSL
