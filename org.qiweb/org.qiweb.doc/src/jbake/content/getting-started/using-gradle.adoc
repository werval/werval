
== Using Gradle

=== Create a new application

To create a new QiWeb application based on Gradle, use the following command:

[source,bash]
----
git archive --format=tar --prefix=YOUR_APP_NAME/ --remote=git@scm.codeartisans.org:qiweb/qiweb-skel-gradle.git master | tar -xf -
----

Where `YOUR_APP_NAME` is, well, your application name.
A directory with this name will be created with the new application in it.

[IMPORTANT]
.What is this horrible command?
====
What the 'horrible' command above does is to export the content of a git repository at a given reference to a directory
of your choice without creating a clone.
In other words, it simply downloads the content of a git repository at a given reference.

A command line client for easy usage of application skeletons is under active discussion, planned and will be added in
a future release.

For the time being, you'll have to copy/paste/edit, or type, this horrible command :)
====


=== Run in development mode

To run a QiWeb application in development mode, use the `devshell` Gradle task:

[source]
----
./gradlew devshell
 _____ _ _ _ _     _      ____          _____ _       _ _
|     |_| | | |___| |_   |    \ ___ _ _|   __| |_ ___| | |
|  |  | | | | | -_| . |  |  |  | -_| | |__   |   | -_| | |
|__  _|_|_____|___|___|  |____/|___|\_/|_____|_|_|___|_|_|
   |__|

Loading...
Compiling Application...
>> QiWeb DevShell starting...
>> Ready for requests on http(s)://127.0.0.1:23023!
----

// TIP: If you want to change the listening address and port override `qiweb.http.address` and `qiweb.http.port` either
// through the command line by adding `-Dqiweb.http.address=0.0.0.0` and `-Dqiweb.http.port=80` for example ; or in the
// `application.conf` file.

You can now open your browser to http://localhost:23023/ to see the welcome page.

image::images/welcome.png[Welcome,640]

[TIP]
====
In production mode, you need an application's secret.
This secret is a key used for cypher and signature operations, it must be unique per application.
Its place is in the application configuration, see `./src/main/resources/application.conf`.
One can generate a new random secret using the `secret` Gradle task:

    ./gradlew secret

It is easily appended to the `application.conf` file this way:

    ./gradlew -q secret >> ./src/main/resources/application.conf

Once you have properly set your application's secret, use the `start` Gradle task to run your application in production mode:

    ./gradlew start
====


=== Application Walkthrough

The newly created application has a single HTTP route:

.`./src/main/resources/routes.conf`
[source,routes]
----
GET / controllers.Application.index
----

That points to this controller method:

.`./src/main/java/controllers/Application.java`
[source,java]
----
public Outcome index()
{
    return outcomes().ok( "Hello QiWeb" ).build();
}
----

Here is the project tree:

    ├── src
    │   └── main
    │       ├── java
    │       │   └── controllers
    │       │       └── Application.java            <= Controller Java Class
    │       └── resources
    │           ├── application.conf                <= Application Configuration
    │           └── routes.conf                     <= Routes
    │
    └── build.gradle                                <= Gradle build file

You can see that applications generated by `qiweb` follow the well known maven directory tree convention.
Yes, it could have simplified things a bit to simply use `src`, `app` or `conf` directory names but this way it's
damn easy to add a Gradle or Maven build to such an application.

At the bottom of the tree you can see the Gradle build file.
Here is what you'll find inside:

.`./build.gradle`
["source","groovy",subs="attributes,callouts"]
----
buildscript {
	repositories {
        maven { url 'https://repo.codeartisans.org/qiweb';credentials { username='qiweb';password='qiweb' } } // <1>
	}
	dependencies { classpath 'org.qiweb:org.qiweb.gradle:{qiweb_version}' }      // <2>
}
repositories {
    maven { url 'https://repo.codeartisans.org/qiweb';credentials { username='qiweb';password='qiweb' } }     // <3>
}

apply plugin: 'java'        // <4>
apply plugin: 'qiweb'       // <5>

dependencies {

    compile "org.qiweb:org.qiweb.api:{qiweb_version}" // <6>
    // Add application compile dependencies here

    runtime "org.qiweb:org.qiweb.server.bootstrap:{qiweb_version}" // <7>
    // Add application runtime dependencies here

    testCompile "org.qiweb:org.qiweb.test:{qiweb_version}" // <8>
    // Add application test dependencies here

}

----
<1> Declare QiWeb repository for the build
<2> Add QiWeb Gradle Plugin to build classpath
<3> Declare QiWeb repository for the application
<4> Apply the Gradle http://www.gradle.org/docs/current/userguide/java_plugin.html[Java Plugin]
<5> Apply the QiWeb Gradle plugin
<6> Add compile scope dependency to QiWeb API
<7> Add runtime scope dependency to QiWeb Netty Server Bootstrap
<8> Add test scope dependency to QiWeb Test Support

TIP: See the link:guides.html#gradle_plugin[QiWeb Gradle Plugin guide] for more insights.

