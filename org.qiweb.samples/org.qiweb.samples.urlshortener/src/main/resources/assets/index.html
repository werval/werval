<!DOCTYPE html>
<html lang="en">
    <head>
        <title>URL Shortener - QiWeb Sample App</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <link href="/client/lib/webjars/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link href="/client/lib/webjars/bootstrap/3.0.0/css/bootstrap-theme.min.css" rel="stylesheet" media="screen">
    </head>
    <body>
        <div class="container">
            <h1>URL Shortener</h1>
            <p class="lead">URL Shortener is a sample application built with <a href="http://qiweb.org/" target="_blank">QiWeb</a></p>
            <div class="row">
                <div class="col-md-3">
                    <form class="form-inline" id="form-shorten">
                        <div class="form-group">
                            <div class="input-group">
                                <input type="url" class="form-control input-sm" id="input-shorten" placeholder="Long URL" required/>
                                <span class="input-group-btn">
                                    <button type="submit" class="btn btn-default btn-sm" id="btn-shorten">
                                        <span class="glyphicon glyphicon-resize-small"></span>
                                        Shorten
                                    </button>
                                </span>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="col-md-3">
                    <form class="form-inline" id="form-expand">
                        <div class="form-group">
                            <div class="input-group">
                                <input type="text" class="form-control input-sm" id="input-expand" placeholder="Hash" required/>
                                <span class="input-group-btn">
                                    <button type="submit" class="btn btn-default btn-sm" id="btn-expand">
                                        <span class="glyphicon glyphicon-resize-full"></span>
                                        Expand
                                    </button>
                                </span>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="col-md-3">
                    <form class="form-inline">
                        <div class="form-group" id="form-lookup">
                            <div class="input-group">
                                <input type="url" class="form-control input-sm" id="input-lookup" placeholder="Long URL" required/>
                                <span class="input-group-btn">
                                    <button type="submit" class="btn btn-default btn-sm" id="btn-lookup">
                                        <span class="glyphicon glyphicon-search"></span>
                                        Lookup
                                    </button>
                                </span>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="col-md-3">
                    <form class="form-inline" id="form-redirect">
                        <div class="form-group">
                            <div class="input-group">
                                <input type="text" class="form-control input-sm" id="input-redirect" placeholder="Hash" required/>
                                <span class="input-group-btn">
                                    <button type="submit" class="btn btn-default btn-sm" id="btn-redirect">
                                        <span class="glyphicon glyphicon-new-window"></span>
                                        Redirect
                                    </button>
                                </span>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <h2>List of shortened URLs</h2>
                    <div id="list_output"></div>
                </div>
                <div class="col-md-6">
                    <h2>API Output</h2>
                    <div id="api_output"></div>
                </div>
            </div>
        </div>
        <script src="/client/lib/webjars/jquery/2.0.3/jquery.min.js"></script>
        <script src="/client/lib/webjars/bootstrap/3.0.0/js/bootstrap.js"></script>
        <script type="text/javascript">
            $(document).ready(function() {
                var $list_out = $("#list_output");
                var $api_out = $("#api_output");
                function data_to_pre_json(data)
                {
                    return "<p><strong>" + new Date() + "</strong></p><pre>" + JSON.stringify(data) + "</pre>";
                }
                function refresh_list()
                {
                    $.getJSON("/api/list", function(data) {
                        $list_out.prepend(data_to_pre_json(data));
                    });
                }
                $("#form-shorten").submit(function(e) {
                    e.preventDefault();
                    $.getJSON("/api/shorten?longUrl=" + $("#input-shorten").val(), function(data) {
                        $api_out.prepend(data_to_pre_json(data));
                        refresh_list();
                    });
                });
                $("#form-expand").submit(function(e) {
                    e.preventDefault();
                    $.getJSON("/api/expand?hash=" + $("#input-expand").val(), function(data) {
                        $api_out.prepend(data_to_pre_json(data));
                    });
                });
                $("#form-lookup").submit(function(e) {
                    e.preventDefault();
                    $.getJSON("/api/lookup?longUrl=" + $("#input-lookup").val(), function(data) {
                        $api_out.prepend(data_to_pre_json(data));
                    });
                });
                $("#form-redirect").submit(function(e) {
                    e.preventDefault();
                    window.open("/" + $("#input-redirect").val());
                });
                refresh_list();
            });
        </script>
    </body>
</html>
